# ROV水下机器人上位机软件项目文档

## 1. 项目概述

本项目旨在开发一个ROV(远程操作潜水器)水下机器人的上位机控制软件。该软件将提供实时视频显示、状态监控、数据采集以及遥控操作等功能，为操作人员提供直观的操作界面和实时反馈。

## 2. 系统架构

系统主要分为以下几个模块：
- 视频显示模块
- 状态监控模块
- 串口通信模块
- 遥控器数据处理模块
- 用户界面模块

## 3. 功能模块说明

### 3.1 视频显示模块

#### 功能描述
- 通过TCP协议接收ROV传输的实时视频流
- 在主界面上实时显示视频画面
- 在视频画面上叠加显示关键数据（深度、航向、电池电压）

#### 实现思路
- 使用TCP Socket建立与ROV的视频流连接
- 采用视频解码器处理接收到的视频数据流
- 使用图形叠加技术在视频画面上实时显示数据

### 3.2 状态监控模块

#### 功能描述
- 显示ROV的深度数据
- 显示ROV的航向信息
- 显示电池电压状态
- 显示舱内温度
- 显示舱内湿度

#### 实现思路
- 通过串口通信接收ROV发送的状态数据
- 解析接收到的数据包
- 实时更新界面显示的数据值
- 可选择性添加数据记录和导出功能

### 3.3 串口通信模块

#### 功能描述
- 串口设备选择功能
- 串口连接状态显示
- 串口数据的收发处理

#### 实现思路
- 实现串口设备扫描和列表显示
- 动态更新串口连接按钮显示状态
  - 未连接时显示"选择串口号"
  - 已连接时显示"串口号：xxxx"
- 实现串口数据的异步收发
- 添加串口通信错误处理机制

### 3.4 遥控器数据处理模块

#### 功能描述
- 识别并连接USB游戏手柄
- 实时读取手柄输入数据
- 显示手柄操作状态
- 将控制指令转发给ROV

#### 实现思路
- 使用游戏手柄驱动接口获取设备数据
- 实时解析手柄的按键和摇杆状态
- 在界面上实时显示控制数据
- 将控制数据打包并通过串口发送给ROV

### 3.5 用户界面模块

#### 功能描述
- 主视频显示区域
- 状态数据显示区域
- 串口控制区域
- 遥控器数据显示区域

#### 实现思路
- 采用模块化的界面设计
- 合理布局各功能区域
- 使用实时更新的数据显示组件
- 添加必要的用户交互控件

## 4. 技术要点

### 4.1 通信协议
- TCP协议用于视频流传输
- 串口通信协议用于控制指令和状态数据传输

### 4.2 数据处理
- 视频流编解码
- 传感器数据解析
- 控制指令封装

### 4.3 实时性要求
- 视频显示延迟控制在200ms以内
- 控制指令响应时间控制在100ms以内
- 状态数据更新频率不低于10Hz

## 5. 注意事项

### 5.1 性能优化
- 优化视频解码和显示性能
- 减少UI更新对系统资源的占用
- 确保多线程操作的同步和互斥

### 5.2 异常处理
- 网络连接异常处理
- 串口通信异常处理
- 设备断开重连机制

### 5.3 用户体验
- 界面操作简单直观
- 关键数据显示清晰
- 异常状态及时提示

## 6. 扩展性考虑

### 6.1 功能扩展
- 预留数据记录和回放功能
- 预留多机器人控制接口
- 预留自动控制功能接口

### 6.2 兼容性
- 支持不同型号的游戏手柄
- 支持不同分辨率的视频输入
- 支持不同的串口通信波特率
